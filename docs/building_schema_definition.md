# SVG план строения

Объекты `строение` `корпус`, `этаж` и `помещение` добавляются в систему на основе парсинга svg-плана строения. Чтобы этот процесс прошёл корректно, план строения должен соответствовать определённой структуре xml-документа.


## Инструменты

Для создания плана строения подходят любые вектоорные графические редакторы, поддерживающие экспорт документов в формате svg и добавление xml-аттрибутов объектам рисунка.

В качестве примера, можно рекомендовать бесплатный редактор *Inkscape*.


## Теги и атрибуты

Для определения объектов приложения на схеме используются xml-атрибуты. При этом каждый объект должен быть представлен в виде группы (xml-тег `<g>`).

Такой подход не накладывает строгое ограничение на структуру документа и позволяет избежать конфликтов со служебными атрибутами и тегами, создаваемыми графическим редактором. За счёт этого достигается относительная свобода в выборе используемых инструментов и стиля работы в графическом редакторе.


## Инициализация схемы

После загрузки в систему, из svg-плана строения парсятся данные для инициализации системных объектов. При инициализации всем объектам присваивается уникальный идентификатор и могут быть присвоены другие специальные атрибуты. 

Исходный план строения обогащается этими атрибутами. В результате, при запросе плана строения через API, клиент получает обогащённую версию svg-плана. 

> Следует различать svg-документ, который только готовится к загрузке в систему, и документ, который уже используется в системе. Последний будет меть более богатый атрибутивный состав. Для различия, первый будем называть **исходным** документом.


## Объекты svg-схемы

Ниже приведён список объектов, определяемых на svg-схеме. Фактически, это части svg-изображения, сгруппированные тегом `<g>` и наделённые xml-атрибутами для корректного сопоставления с объектами данных приложения.

> Атрибуты исходного плана помечены символом `!`. Эти атрибуты должны присутствовать в документе до загрузки в систему. Остальные атрибуты генерируются системой автоматически и не должны указываться вручную.

> **! Примечание**: на данный момент **все** атрибуты svg-схемы размечаются в ручном режиме. Ответственность за уникальность идентификаторов объектов svg-схемы лежит на пользователе, составляющем план помещений.

### `building`
**Описание:** Объект, представляющий здание организации

**Атрибуты:**
- `!` `type` *string*  \
Атрибут, указывающий на тип объекта. Для всех объектов этого типа должен иметь значение `type=building`
- `!` `building-name` *string* \
Название строения. Любое текстовое значенеи.
- `!` `building-id` *int* \
Идентификатор строения. 
- `!` `geopoint-lt` *string*\
Географические координаты левого верхнего угла svg-документа.
- `!` `geopoint-rb` *string*\
Географические координаты правого нижнего угла svg-документа.

### `unit`
**Описание:** Объект, представляющий корпус организации

**Атрибуты:**
- `!` `type` *string*\
Атрибут, указывающий на тип объекта. Для всех объектов этого типа должен иметь значение `type=unit`
- `!` `unit-name` *string*\
Имя корпуса организации.
- `!` `unit-id` *int* \
Идентификатор корпуса организации.
    

### `floor`

**Описание:** Объект, представляющий этаж здания.

**Атрибуты:**
- `!` `type` *string*\
Атрибут, указывающий на тип объекта. Для всех объектов этого типа должен иметь значение `type=floor`
- `!` `floor-name` *string* \
Название этажа. Любое текстовое значение.
- `!` `floor-level` *int* \
Фактический порядковый номер этажа. Надземные этажи нумеруются снизу вверх, начиная с 1. Подземные этажи нумеруются сверху вниз, начиная с -1.
- `!` `floor-id` *int* \
Уникальный идентификатор этажа.

### `room`

**Описание:** Объект, представляющий помещение. Должен быть вложен в группу, представляющую объект этажа.

**Атрибуты:**
- `!` `type` *string* \
Атрибут, указывающий на тип объекта. Для всех объектов этого типа, должен иметь значение `type=room`
- `!` `room-name` *string* \
Название комнаты. Любое текстовое значение.
- `!` `room-id` *int* \
Уникальный идентификатор помещения.


## Структура документа

План строения содержится в едином svg-документе. Примерная структура документа приведена ниже.

```svg
<svg ...>
    ...
    <g type="building" building-name="ВГУ главное здание" building-id="1" geopoint-lt="51.656625, 39.205129" geopoint-rb="51.655799, 39.207413">
        ...
        <g type="unit" unit-name="Первый корпус" unit-id="1">
            <g type="floor" floor-name="Этаж 1" floor-level="1" floor-id="1">
                ...
                <g type="room" room-name="Аудитория №106" room-id="1">
                    ...
                </g>
                <g type="room" room-name="Аудитория №107" room-id="2">
                    ...
                </g>
                ...
            <g>
            <g type="floor" floor-name="Этаж 2" floor-level="2" floor-id="2">
                ...
                <g type="room" room-name="Аудитория №203" room-id="3">
                    ...
                </g>
                <g type="room" room-name="Аудитория №201" room-id="4">
                    ...
                </g>
                ...
            <g>
            ...
        </g>
        ...
    </g>
</svg>
```


## Пример

[Пример исходной схемы ](/docs/examples/VSU_main_building_example.svg)

> За основу взято существующее здание Воронежского Государственного Университета, однако расположение и наименование аудиторий вымешлено. План здания не соответствует действительности и служит лишь примером организации структуры svg-документа.
