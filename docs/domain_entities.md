# Бизнес-сущности OpenRoom

> В этом разделе приводится описание основных бизнес-сущностей предметной области. Это концептуальное представление, описывающее общие бизнес-правила работы системы. Данный документ не предлагает конкретный атрибутный состав сущностей, но является основополагающим при его разработке.


## Содержание
- [Бизнес-сущности OpenRoom](#бизнес-сущности-openroom)
  - [Содержание](#содержание)
  - [Пользователь](#пользователь)
    - [Создание пользователя](#создание-пользователя)
    - [Роль и права пользователя](#роль-и-права-пользователя)
      - [Наблюдатель](#наблюдатель)
      - [Организатор](#организатор)
      - [Администратор](#администратор)
      - [Владелец](#владелец)
  - [Корпус предприятия](#корпус-предприятия)
    - [Создание корпуса](#создание-корпуса)
  - [Помещение](#помещение)
    - [Создание помещения](#создание-помещения)
    - [Администрирование помещения](#администрирование-помещения)
  - [Мероприятие](#мероприятие)
    - [Создание мероприятия (бронирование помещения)](#создание-мероприятия-бронирование-помещения)
    - [Вход на мероприятие](#вход-на-мероприятие)
    - [Открытые и закрытые мероприятия](#открытые-и-закрытые-мероприятия)
    - [Статус мероприятия](#статус-мероприятия)
  - [Группа помещений](#группа-помещений)
    - [Создание группы помещений](#создание-группы-помещений)
    - [Видимость группы](#видимость-группы)
  - [Группа пользователей](#группа-пользователей)
    - [Создание группы помещений](#создание-группы-помещений-1)
    - [Видимость группы](#видимость-группы-1)
  - [Приглашение на мероприятие](#приглашение-на-мероприятие)
    - [Создание приглашения](#создание-приглашения)
    - [Статус приглашения](#статус-приглашения)
  - [Заявка на посещение мероприятия](#заявка-на-посещение-мероприятия)
    - [Создание заявки](#создание-заявки)
    - [Статус заявки](#статус-заявки)


## Пользователь
Сущность, ассоциированная с человеком, использующим систему.

### Создание пользователя
Сущность пользователя создаётся при регистрации человека в системе. В зависимости от политик конкретной организации, пользователь может зарегистрироваться в системе самостоятельно, либо быть добавленным владельцем системы.

### Роль и права пользователя
Права пользователей зависят от присвоенной им роли в системе. Каждая роль обладает набором прав, при этом каждый конкретный пользователь может обладать как полным набором прав его роли, так и ограниченным их набором. 

Кроме того, права пользователей в системе можно поделить на две основных категории:
- Права в отношении помещений (далее обозначаются как `room`).
- Права в отношении системы (далее обозначаются как `sys`).

При присвоении `room`-прав пользователю, указывается конкретный список помещений, на которые эти права распространяются.

В системе предусмотрена следующая иерархия ролей:
- Наблюдатель 
- Организатор
- Администратор
- Владелец

"Cтаршая" роль наследует все `sys`-права "младшей" роли. Права в отношении помещений имеют свою иерархию наследования.

> Т.е любой Администратор будет обладать всеми `sys`-правами роли Организатор (хотя некоторые пользователи с правами Организатора могут обладать не всеми правами, доступными их роли). 
> 
> Однако, Администратор не будет обладать правами Организатора для тех помещений, для которых ему не выданы `room`-права Администратора, либо права Организатора.

Далее приведён список прав, доступных для каждой роли.

#### Наблюдатель
Роль наблюдателя по умолчанию присваивается новым пользователям системы. Наблюдатель имеет *базовые права на использование системы*:
- Просмотр списка мероприятий `sys`
- Регистрация на посещение мероприятия `sys`

#### Организатор
Роль организатора даёт пользователю следующие права:
- Создание непубличных групп пользователей `sys`
- Создание мероприятий `room`

#### Администратор
Роль администратора даёт пользователю следующие права:
- Создание публичных групп пользователей `sys`
- Создание непубличных групп помещений `sys`
- Создание публичных групп помещений `sys`
- Изменение прав пользователей (присвоение ролей) `sys`
- Администрирование помещения `room`

#### Владелец
Роль владельца по умолчанию присваивается пользователю, созданному при инициализации системы. 

Владелец имеет полный перечень прав администратора, в том числе в  отношении всех помещений.


## Корпус предприятия
Корпус предприятия - строение, имеющее план помещений. Любое строение или часть строения, имеющее отдельный план помещений, должно считаться корпусом.

### Создание корпуса
Корпус создаётся на основе плана помещений, загруженного в систему. При этом план помещений должен представлять из себя svg-документ и соответствовать определённой структуре.


## Помещение
Помещение предприятия принадлежит к существующему корпусу предприятия и имеет расположение на нём.

### Создание помещения
Помещение создаётся на основе плана помещений корпуса, загруженного в систему.

### Администрирование помещения
Если пользователь имеет по отношению к помещению право на администрирование, он становится Администратором этого помещения. Любой Администратор обладает и правами Организатора на соответствующее помещение.

Администратору становятся видны все мероприятия, создаваемые для даного помещения. Администратор должен подтвердить либо отклонить проведение мероприятия. Также Администратор может отменить проведение уже одобренного мероприятия, при необходимости.

Администратор может поставить автоподтверждение на проведение мероприятий в данном помещении для выбранного круга пользователей - тогда все мероприятия, создаваемые указанными пользователями, будут автоматически подтверждаться без его участия.


## Мероприятие
Мероприятие привязано к помещению, имеет время начала и время окончания.

### Создание мероприятия (бронирование помещения)
Создать мероприятие в помещении может пользователь с сответствующими правами в отношении этого помещения.

### Вход на мероприятие
На мероприятие может быть свободный вход - тогда прийти на него может любой желающий. В ином случае для посещения мероприятия потребуется подать заявку на посещение, которая будет рассматриваться организатором мероприятия.

### Открытые и закрытые мероприятия
Мероприятие может быть открытым (по умолчанию) и закрытым. Открытое мероприятие видно всем пользователям в списке мероприятий. Закрытое мероприятие не отображается в списке мероприятий и прийти на него могут только приглашённые пользователи.

### Статус мероприятия
- В момент создания мероприятию присваивается статус "Неподтверждённый" (`UNCONFIRMED`). Это значит что мероприятие создано в системе, но его проведение ещё не утверждено Администратором. Такие мероприятия не видны рядовым пользователям.
- После подтверждения Администратором, мероприятие получает статус "Подтверждено" (`CONFIRMED`). После этого пользователи могут увидеть его в списке мероприятий.
- Если мероприятие отклонено администратором, оно получает статус "Отклонено" (`REJECTED`) и остаётся невидимым для рядовых пользователей.
- Если после подтверждения Администратором, Администратор или Организатор отменил мероприятие, ему присваивается статус "Отменено" (`CANCELLED`). Такое мероприятие пропадает из списка мероприятий для рядовых пользователей.
- Проведённое мероприятие получает статус "Проведено" (`FINISHED`).


## Группа помещений
Группа помещений - это несколько помещений, объединённых в именованную группу. 

### Создание группы помещений
Группа помещений создаётся пользователем. Для этого пользователь должен обладать соответствующими правами. Изменять или удалять группу может только пользователь, создавший её.

### Видимость группы
Группа помещений может быть публичной - такую группу видят все пользователи. Для создания такой группы нужно обладать соответствующими правами. \
Также, полльзователь может создать приватную группу - такую группу будет видеть только пользователь, её создавший. 


## Группа пользователей
Группа пользователей - это несколько пользователей, объединённых в именованную группу.

### Создание группы помещений
Группа пользователей создаётся пользователем. Для этого пользователь должен обладать соответствующими правами. Изменять или удалять группу может только пользователь, создавший её.

### Видимость группы
Группа пользователей может быть публичной - такую группу видят все пользователи. Для создания такой группы нужно обладать соответствующими правами. \
Также, полльзователь может создать приватную группу - такую группу будет видеть только пользователь, её создавший. 


## Приглашение на мероприятие

### Создание приглашения
После создания мероприятия, Организатор может пригласить на него выбранных пользователей. Тогда создаётся приглашение, и приглашённые пользователи получают уведомление.

### Статус приглашения
- При создании, приглашение имеет статус "Ожидание" (`WAITING`). Это значит, что приглашённый пользователь ещё не принял приглашение.
- Если пользователь принимает приглашение, ему присваивается статус "Принято" (`ACCEPTED`). В таком случае считается, что пользователь явится на мероприятие.
- Если пользователь отклонил приглашение, ему присваивается статус "Отклонено" (`REJECTED`). Пользователь отказался от посещения мероприятия.


## Заявка на посещение мероприятия

### Создание заявки
Заявка на посещение мероприятия создаётся пользователем, который хочет посетить мероприятие, вход на которое не является свободным.

### Статус заявки
- При создании, заявка имеет статус "Ожидание" (`WAITING`). Это значит, что организатор ещё не принял решение касательно этой заявки.
- Если организатор одобрил заявку на посещение, ей присваивается статус "Подтверждено" (`CONFIRMED`) - пользователь, подавший заявку, может посетить мероприятие.
- Если же организатор отклонит заявку, ей присваивается статус "Отклонено" (`REJECTED`) - пользователю, подавшему заявку, отказано в посещении мероприятия.
